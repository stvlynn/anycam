## 结论（基于文档）
- Mapbox Geocoding 支持逆地理：通过 `/{lng},{lat}.json` 返回 `features`，可包含 `address`（门牌+街道）、`place`、`locality`、`neighborhood` 等类型；可用 `types`、`language`、`limit`、`proximity` 参数优化结果。
- Mapbox GL JS 可在点击点位用 `map.queryRenderedFeatures(point, { layers })` 查询样式中的道路/标注图层，解析 `feature.properties.name` 获取街道名（如 `road-label`）。

## 目标
- 点击地图时优先用 Geocoding 逆地理获取更详细街道/地址；若无则回退用 `queryRenderedFeatures` 读取道路名称；最终填充 `name`、`city`、`street`（或 `address`）。

## 实现方案
- 逆地理请求：
  - URL：`https://api.mapbox.com/geocoding/v5/mapbox.places/{lng},{lat}.json`
  - 参数：`access_token`、`types=address,poi,place,locality,neighborhood`、`limit=1`、`language=zh`（可选）
  - 解析：
    - `street/address`: `feature.address ? feature.address + ' ' + feature.text : feature.text`
    - `city`: 从 `feature.context` 中优先 `place/locality/region` 的 `text`
    - `name`: `feature.text` 或更完整的 `feature.place_name`
- 样式回退（GL JS）：
  - 在点击事件处计算屏幕像素点 `e.point`，调用 `map.queryRenderedFeatures(e.point, { layers: ['road-label'] })`
  - 取第一条 `feature.properties.name` 作为 `street` 回填
- 字段填充与回退：
  - 成功：`{ id, name, city, street, coords }`
  - 失败：`{ name: '{lng},{lat}', city: '', street: '' }`

## 代码改动
- `frontend/src/components/MapSelector.jsx`
  - 将点击事件改为：
    1) 发起逆地理请求（参数按上文）
    2) 若无 `address`/`text`，调用 `queryRenderedFeatures` 取 `road-label` 的 `name`
    3) 归一化字段并 `setSelectedLocation`
  - 可选环境变量：`VITE_MAPBOX_LANGUAGE`（默认不传则返回英文或本地化依赖 token 设置）

## 验证
- 有 Token：点击后展示“名称（含街道）+ 城市”，热门地点与搜索建议行为不变。
- 无 Token：保留降级提示，不发请求，回退为坐标字符串。

## 注意
- Geocoding 的 `types` 不含 `street` 类型，应使用 `address` 获取门牌街道；若无门牌，`place_name` 仍含街道信息。
- `queryRenderedFeatures` 取决于当前样式（如 `streets-v12` 的 `road-label` 层），需按实际样式 Layer ID 调整。